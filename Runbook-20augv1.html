<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotifyBot - Advanced Email Notification Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            margin-top: 20px;
            margin-bottom: 20px;
        }
        
        .header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .nav {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        
        .nav h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .nav ul {
            list-style: none;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        
        .nav li {
            color: #3498db;
            text-decoration: none;
            padding: 8px 12px;
            border-radius: 5px;
            transition: all 0.3s ease;
            display: block;
            border: 1px solid transparent;
            cursor: default;
        }
        
        .nav li:hover {
            background: #3498db;
            color: white;
            transform: translateX(5px);
            box-shadow: 0 3px 10px rgba(52, 152, 219, 0.3);
        }
        
        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: white;
            border-radius: 12px;
            border-left: 5px solid #3498db;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section h2 {
            color: #2c3e50;
            font-size: 2rem;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ecf0f1;
        }
        
        .section h3 {
            color: #34495e;
            font-size: 1.4rem;
            margin: 25px 0 15px 0;
        }
        
        .section h4 {
            color: #2c3e50;
            font-size: 1.2rem;
            margin: 20px 0 10px 0;
        }
        
        /* Custom bullet points */
        ul:not(.nav ul) {
            list-style: none;
            padding-left: 0;
        }
        
        ul:not(.nav ul) li {
            position: relative;
            padding-left: 30px;
            margin-bottom: 8px;
        }
        
        ul:not(.nav ul) li::before {
            content: "▶";
            position: absolute;
            left: 0;
            top: 0;
            color: #3498db;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        /* Different bullet styles for nested lists */
        ul:not(.nav ul) ul li::before {
            content: "◆";
            color: #2ecc71;
        }
        
        ul:not(.nav ul) ul ul li::before {
            content: "●";
            color: #e74c3c;
        }
        
        .highlight {
            background: linear-gradient(135deg, #87ceeb, #b0e0e6);
            color: #2c3e50;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 8px 25px rgba(135, 206, 235, 0.3);
        }
        
        .highlight h3 {
            color: #2c3e50;
            margin-top: 0;
        }
        
        .code-block {
            background: #1a1a1a;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
            border: 1px solid #333;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: pre-wrap;
        }
        
        .code-block .comment {
            color: #75715e;
        }
        
        .code-block .keyword {
            color: #66d9ef;
        }
        
        .code-block .string {
            color: #a6e22e;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #f39c12;
        }
        
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #17a2b8;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 5px solid #28a745;
        }
        
        .file-structure {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            border: 1px solid #dee2e6;
            margin: 15px 0;
            white-space: pre;
            overflow-x: auto;
            line-height: 1.4;
        }
        
        .file-structure .folder {
            color: #3498db;
            font-weight: bold;
        }
        
        .file-structure .file {
            color: #2ecc71;
        }
        
        .file-structure .comment {
            color: #7f8c8d;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background: #3498db;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f5f5f5;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            background: #3498db;
            border-radius: 20px;
            margin: 2px;
        }
        
        .badge.required {
            background: #e74c3c;
        }
        
        .badge.optional {
            background: #95a5a6;
        }
        
        .badge.new {
            background: #2ecc71;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .emoji {
            font-size: 1.2em;
            margin-right: 5px;
        }
        
        .button-link {
            display: inline-block;
            background: linear-gradient(45deg, #3498db, #2ecc71);
            color: white;
            padding: 12px 20px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 15px 0;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .button-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
            color: white;
        }
        
        .important {
            background: #ffe6e6;
            padding: 15px;
            border-left: 6px solid #cc0000;
            margin: 20px 0;
            font-weight: bold;
            color: #660000;
            border-radius: 6px;
        }
        
        .tip {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            border-left: 5px solid #17a2b8;
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.1);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-top: 4px solid #3498db;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .feature-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .footer {
            background: linear-gradient(45deg, #2c3e50, #3498db);
            color: white;
            text-align: center;
            padding: 30px;
            border-radius: 10px;
            margin-top: 40px;
        }
        
        .test-mode-highlight {
            background: #d4edda;
            border: 3px solid #28a745;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.2);
        }
        
        .command-examples {
            background: #1a1a1a;
            padding: 25px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .command-examples h4 {
            color: #f8f8f2;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .command-examples .code-block {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav ul {
                grid-template-columns: 1fr;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><span class="emoji">🚀</span>NotifyBot User Runbook</h1>
			<p style="margin-left: 75px;">NotifyBot - Advanced Email Notification Tool</p>
        </div>

        <div class="section features">
            <p>
                <strong>NotifyBot</strong> is our intelligent, scalable solution for email automation.  
                Whether you're sending a handful of emails or thousands, NotifyBot makes it effortless, safe, and efficient.  
                It supports both single and multi modes, with comprehensive testing capabilities including the new <strong>test mode</strong> feature.
            </p>
            <ul class="feature-list">
                <li>📧 <strong>Batch Email Sending</strong>: Deliver emails in customizable batches with controlled delays</li>
                <li>🖋️ <strong>HTML Email Support</strong>: Craft rich, styled messages with attachments and embedded images</li>
                <li>🎯 <strong>Recipient Filtering</strong>: Advanced CSV filtering with regex and wildcard support</li>
                <li>🧪 <strong>Dry Run Mode</strong>: Test configurations safely without sending actual emails</li>
                <li>🧪 <strong>Test Mode</strong> <span class="badge new">NEW</span>: Use separate test inventory for safe testing</li>
                <li>✅ <strong>Email Validation</strong>: RFC-compliant address validation to reduce bounces</li>
                <li>📎 <strong>Attachment Support</strong>: Attach files up to 15MB total per campaign</li>
                <li>🔁 <strong>Deduplication</strong>: Automatically remove duplicate recipients</li>
                <li>📊 <strong>Comprehensive Logging</strong>: Detailed audit trails with automatic log rotation</li>
                <li>🎨 <strong>Dynamic Tables</strong>: Generate personalized HTML tables from CSV data</li>
            </ul>
            <p><em>Stay in control. Stay efficient. That's the NotifyBot way.</em></p>
        </div>

        <div class="important">
            🚨 <strong>Critical Safety Guidelines</strong><br><br>
            🧪 Always run NotifyBot in <code>--dry-run</code> mode first to verify recipients and content<br>
            🧪 Use <code>--test</code> mode for safe testing with test inventory data<br>
            ❌ Never use <code>--force</code> unless running in a fully automated script with prior approval<br>
            ⚠️ Running live without dry-run review may result in unintended mass emails<br>
            📂 The <code>&lt;user-basefolder&gt;</code> is your campaign directory inside <code>/notifybot/basefolder/</code>
        </div>

        <div class="tip">
            💡 <strong>Pro Tip:</strong> Replace <code>&lt;user-basefolder&gt;</code> with your actual campaign folder name.  
            Example: For folder <code>newsletter_august</code>, use:  
            <br><code>/notifybot/venv/bin/python notifybot.py --base-folder newsletter_august --test --dry-run</code>
        </div>

        <div class="nav">
            <h3><span class="emoji">📋</span>Table of Contents</h3>
            <ul>
                <li>🎯 Overview & Key Features</li>
                <li>📁 Directory Structure</li>
                <li>⚙️ Operating Modes</li>
                <li>🧪 Test Mode (NEW)</li>
                <li>✅ Field Validation System</li>
                <li>🔍 Advanced Filter Syntax</li>
                <li>🎨 Template & Dynamic Tables</li>
                <li>👥 Recipient Management</li>
                <li>📄 File Format Specifications</li>
                <li>✨ Advanced Features</li>
                <li>📊 Logging & Monitoring</li>
                <li>🚀 Usage Examples</li>
                <li>🔒 Security & Best Practices</li>
            </ul>
        </div>

        <div class="section" id="overview">
            <h2><span class="emoji">🎯</span>Overview & Key Features</h2>
            <p>NotifyBot is a sophisticated email automation platform supporting both single and multi-mode campaigns with advanced template personalization, batch processing, image embedding, and comprehensive recipient management through CSV-based filtering with priority-based field validation.</p>
            
            <div class="highlight">
                <h3>🌟 Core Capabilities</h3>
                <ul>
                    <li><strong>SINGLE MODE:</strong> One email campaign distributed to all matching recipients</li>
                    <li><strong>MULTI MODE:</strong> Multiple personalized emails based on filter conditions</li>
                    <li><strong>TEST MODE:</strong> Safe testing environment with separate test inventory</li>
                    <li>Comprehensive dry-run testing with draft emails to approvers</li>
                    <li>Intelligent batch processing with configurable delays and sizes</li>
                    <li>Rich HTML email support with embedded images and file attachments</li>
                    <li>Advanced filtering with regex, wildcard, and boolean logic support</li>
                    <li>Dynamic table generation with multiple styling options</li>
                    <li>Priority-based field validation ensuring data integrity</li>
                    <li>Comprehensive audit logging with real-time Splunk integration</li>
                </ul>
            </div>
        </div>

        <div class="section" id="directory-structure">
            <h2><span class="emoji">📁</span>Directory Structure</h2>
            
            <div class="file-structure">/notifybot/                          <span class="comment"># Root directory (NOTIFYBOT_ROOT)</span>
├── basefolder/                      <span class="comment"># Base folder for all campaigns</span>
│   └── &lt;campaign-name&gt;/             <span class="comment"># Individual campaign folder</span>
│       ├── subject.txt              <span class="comment"># Email subject line</span>
│       ├── body.html                <span class="comment"># Email body (HTML format)</span>
│       ├── from.txt                 <span class="comment"># Sender email address</span>
│       ├── approver.txt             <span class="comment"># Approver emails for dry-run mode</span>
│       ├── to.txt                   <span class="comment"># Direct recipient list (optional)</span>
│       ├── cc.txt                   <span class="comment"># CC recipients (optional)</span>
│       ├── bcc.txt                  <span class="comment"># BCC recipients (optional)</span>
│       ├── additional_to.txt        <span class="comment"># Additional TO recipients (optional)</span>
│       ├── filter.txt               <span class="comment"># Filter conditions (required for multi-mode)</span>
│       ├── field.txt                <span class="comment"># Field names for template substitution (optional)</span>
│       ├── mode.txt                 <span class="comment"># Mode specification: 'single' or 'multi' (optional)</span>
│       ├── table-columns.txt        <span class="comment"># Column specification for dynamic tables (conditional)</span>
│       ├── field-inventory.csv      <span class="comment"># Local field inventory (optional, takes priority)</span>
│       ├── attachment/              <span class="comment"># Folder for file attachments (optional)</span>
│       │   └── *.* (files)          <span class="comment"># Attachment files (15MB total limit)</span>
│       ├── images/                  <span class="comment"># Folder for email images (optional)</span>
│       │   └── *.{jpg,png,gif}      <span class="comment"># Image files for embedding</span>
│       └── recipients/              <span class="comment"># Auto-generated recipient backups</span>
├── inventory/
│   ├── inventory.csv                <span class="comment"># Global recipient database</span>
│   └── test-inventory.csv           <span class="comment"># Test recipient database (NEW)</span>
├── signature.html                   <span class="comment"># Global email signature</span>
└── logs/
    └── notifybot.log                <span class="comment"># Comprehensive execution logs</span></div>
        </div>

        <div class="section" id="operating-modes">
            <h2><span class="emoji">⚙️</span>Operating Modes</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h4><span class="emoji">📤</span>SINGLE MODE</h4>
                    <ul>
                        <li>Sends ONE email to all matching recipients</li>
                        <li>Recipients from: to.txt, filter.txt, additional_to.txt</li>
                        <li>Template personalization using field substitution</li>
                        <li>Batch processing for large recipient lists</li>
                        <li><strong>Example:</strong> Company-wide announcement</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">📬</span>MULTI MODE</h4>
                    <ul>
                        <li>Sends MULTIPLE personalized emails</li>
                        <li>Each filter condition generates separate email</li>
                        <li>Recipients filtered from inventory.csv per condition</li>
                        <li>Dynamic table generation support</li>
                        <li><strong>Example:</strong> Department-specific notifications</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section" id="test-mode">
            <h2><span class="emoji">🧪</span>Test Mode (NEW)</h2>
            
            <div class="test-mode-highlight">
                <h3>🎯 Safe Testing Environment</h3>
                <p>Test Mode provides a completely safe testing environment using separate inventory data, ensuring production data remains untouched during development and testing phases.</p>
            </div>
            
            <h3>Test Mode Features</h3>
            <ul>
                <li><strong>--test flag:</strong> Automatically uses test-inventory.csv instead of production inventory.csv</li>
                <li><strong>--test-inventory PATH:</strong> Specify custom test inventory file location</li>
                <li>All validation and filtering operations use test data exclusively</li>
                <li>Clear logging indicators when operating in test mode</li>
                <li>Complete isolation from production recipient data</li>
                <li>Compatible with both dry-run and live modes</li>
            </ul>
            
            <h3>Test Inventory Priority</h3>
            <div class="info">
                <h4>Inventory Selection Logic:</h4>
                <ul>
                    <li><strong>Production Mode:</strong> Uses /notifybot/inventory/inventory.csv</li>
                    <li><strong>Test Mode (--test):</strong> Uses /notifybot/inventory/test-inventory.csv</li>
                    <li><strong>Custom Test (--test-inventory PATH):</strong> Uses specified file path</li>
                    <li><strong>Local Override:</strong> field-inventory.csv always takes priority when present</li>
                </ul>
            </div>
            
            <div class="command-examples">
                <h4><span class="emoji">💻</span>Test Mode Commands</h4>
                <div class="code-block"><span class="comment"># Test mode with dry-run (safest approach)</span>
/notifybot/venv/bin/python notifybot.py --base-folder campaign --test --dry-run

<span class="comment"># Test mode with custom inventory</span>
/notifybot/venv/bin/python notifybot.py --base-folder campaign --test-inventory /path/to/test.csv --dry-run

<span class="comment"># Live test mode (uses test inventory but sends real emails)</span>
/notifybot/venv/bin/python notifybot.py --base-folder campaign --test</div>
            </div>
        </div>

        <div class="section" id="field-validation">
            <h2><span class="emoji">✅</span>Field Validation System</h2>
            
            <p>Priority-based validation ensures data integrity across all inventory sources:</p>
            
            <div class="info">
                <h4>1. FILTER VALIDATION (filter.txt):</h4>
                <ul>
                    <li>Validated against chosen inventory (production/test)</li>
                    <li>If local field-inventory.csv exists, also validated against it</li>
                    <li>All filter field names must exist in inventory headers</li>
                    <li>Test mode automatically uses test inventory for validation</li>
                </ul>
            </div>
            
            <div class="info">
                <h4>2. FIELD VALIDATION (field.txt):</h4>
                <ul>
                    <li>Priority: local field-inventory.csv > chosen inventory (production/test)</li>
                    <li>Used for template substitution and dynamic table generation</li>
                    <li>Dynamic table fields require table-columns.txt validation</li>
                    <li>Respects test mode inventory selection</li>
                </ul>
            </div>
            
            <div class="warning">
                <h4>3. STRICT DYNAMIC TABLE VALIDATION:</h4>
                <ul>
                    <li>If any dynamic table field requested: table-columns.txt MUST exist</li>
                    <li>table-columns.txt MUST be non-empty</li>
                    <li>All columns MUST exist in chosen inventory file</li>
                    <li>Test mode applies same validation rules to test inventory</li>
                </ul>
            </div>
        </div>

        <div class="section" id="filter-syntax">
            <h2><span class="emoji">🔍</span>Advanced Filter Syntax</h2>
            
            <p>Supports advanced PromQL-style filtering with multiple operators and boolean logic:</p>
            
            <h3>Filter Operators</h3>
            <table>
                <thead>
                    <tr>
                        <th>Operator</th>
                        <th>Description</th>
                        <th>Example</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>=</code></td>
                        <td>Exact match (case-insensitive)</td>
                        <td><code>department="Engineering"</code></td>
                    </tr>
                    <tr>
                        <td><code>!=</code></td>
                        <td>Not equal</td>
                        <td><code>status!="inactive"</code></td>
                    </tr>
                    <tr>
                        <td><code>=~</code></td>
                        <td>Regex match</td>
                        <td><code>name=~"^John.*"</code></td>
                    </tr>
                    <tr>
                        <td><code>!~</code></td>
                        <td>Regex not match</td>
                        <td><code>email!~".*(test|demo).*"</code></td>
                    </tr>
                    <tr>
                        <td><code>*,?,[]</code></td>
                        <td>Wildcard patterns</td>
                        <td><code>department=*Sales*</code></td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Boolean Logic Operations</h3>
            <div class="code-block"><span class="comment"># AND logic: Same line, comma-separated</span>
department="Engineering",status="active",region!="asia"

<span class="comment"># OR logic: Different lines</span>
department="Engineering"
department="Sales"
department="Marketing"

<span class="comment"># Comments and empty lines ignored</span>
# This filters active engineering staff
department="Engineering",status="active"</div>
            
            <h3>Complex Filter Examples</h3>
            <div class="code-block"><span class="comment"># Department-based filtering with exclusions</span>
department="Engineering"
department="Sales"

<span class="comment"># Exclude test accounts using regex</span>
email!~".*(test|demo|staging).*"

<span class="comment"># Multiple conditions (AND logic)</span>
department="Sales",status="active",region!="asia"

<span class="comment"># Complex regex patterns for titles</span>
title=~".*(Manager|Director|VP).*"

<span class="comment"># Wildcard matching for flexible searches</span>
location=*York*,status="active"</div>
        </div>

         <div class="section" id="template-substitution">
            <h2><span class="emoji">🎨</span>Template Substitution & Dynamic Tables</h2>
            
            <p>Field values from inventory CSV can be substituted into email templates with intelligent formatting:</p>
            
            <h3>Basic Field Substitution</h3>
            <div class="code-block"><span class="comment">Template:</span> "Hello {name}, welcome to {department}!"
<span class="comment">Result:</span>   "Hello John Smith, welcome to Engineering!"

<span class="comment">Multi-value fields:</span> {skills} → "Python, Java, and JavaScript"</div>
            
            <h3>Dynamic Table Generation</h3>
            <table>
                <thead>
                    <tr>
                        <th>Placeholder</th>
                        <th>Description</th>
                        <th>Output</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>{dynamic_table}</code></td>
                        <td>Complete HTML table with styling</td>
                        <td>Full table with headers and styled rows</td>
                    </tr>
                    <tr>
                        <td><code>{table_rows}</code></td>
                        <td>Table rows only</td>
                        <td>Standard HTML table rows</td>
                    </tr>
                    <tr>
                        <td><code>{styled_table_rows}</code></td>
                        <td>Striped table rows</td>
                        <td>Alternating background colors</td>
                    </tr>
                    <tr>
                        <td><code>{simple_table_rows}</code></td>
                        <td>Minimal table rows</td>
                        <td>Clean, unstyled rows</td>
                    </tr>
                    <tr>
                        <td><code>{csv_table_rows}</code></td>
                        <td>Pipe-separated text</td>
                        <td>Plain text table format</td>
                    </tr>
                    <tr>
                        <td><code>{table_headers}</code></td>
                        <td>Table headers only</td>
                        <td>Styled column headers</td>
                    </tr>
                </tbody>
            </table>
            
            <h3>Multi-Value Field Formatting</h3>
            <div class="code-block"><span class="comment">Single value:</span>   {skills} → "Python"
<span class="comment">Two values:</span>    {skills} → "Python and Java"
<span class="comment">Multiple:</span>      {skills} → "Python, Java, and JavaScript"
<span class="comment">Many values:</span>   {skills} → "Python, Java, JavaScript, and 12 more"</div>

            <h3>Dynamic Table Configuration</h3>
            <div class="info">
                <p><strong>table-columns.txt requirements:</strong></p>
                <ul>
                    <li>Required when any dynamic table placeholder is used</li>
                    <li>One column name per line</li>
                    <li>All columns must exist in chosen inventory</li>
                    <li>Comments supported with # prefix</li>
                </ul>
            </div>
        </div>

        <div class="section" id="recipient-sources">
            <h2><span class="emoji">👥</span>Recipient Management</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h4>SINGLE MODE <span class="badge required">requires at least ONE</span></h4>
                    <ul>
                        <li><strong>to.txt:</strong> Direct email list (semicolon-separated)</li>
                        <li><strong>filter.txt + inventory:</strong> Filtered recipients from chosen inventory</li>
                        <li><strong>additional_to.txt:</strong> Additional recipients (merged with primary)</li>
                        <li><strong>cc.txt:</strong> CC recipients (added to all emails)</li>
                        <li><strong>bcc.txt:</strong> BCC recipients (added to all emails)</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>MULTI MODE <span class="badge required">required</span></h4>
                    <ul>
                        <li><strong>filter.txt:</strong> Multiple filter conditions (one per email)</li>
                        <li><strong>inventory:</strong> Source database for filtering (production/test)</li>
                        <li><strong>cc.txt, bcc.txt:</strong> Added to each individual email</li>
                        <li><strong>additional_to.txt:</strong> Added to each filtered recipient list</li>
                    </ul>
                </div>
            </div>
            
            <h3>Recipient Processing Logic</h3>
            <div class="info">
                <ol>
                    <li>Primary recipients determined (to.txt OR filter results)</li>
                    <li>additional_to.txt merged with primary recipients</li>
                    <li>Automatic deduplication (case-insensitive)</li>
                    <li>CC/BCC added to each email batch</li>
                    <li>Final recipient lists saved for audit</li>
                </ol>
            </div>
        </div>

        <div class="section" id="file-formats">
            <h2><span class="emoji">📄</span>File Format Specifications</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h4>📝 TEXT FILES (.txt)</h4>
                    <ul>
                        <li>UTF-8 encoding required</li>
                        <li>Line endings: Unix (LF) or Windows (CRLF)</li>
                        <li>Email lists: semicolon-separated, one per line</li>
                        <li>Comments: Lines starting with # are ignored</li>
                        <li>Empty lines: Automatically ignored</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>🌐 HTML FILES</h4>
                    <ul>
                        <li>Valid HTML5 structure recommended</li>
                        <li>Inline CSS preferred for email compatibility</li>
                        <li>Image references: relative paths to images/ folder</li>
                        <li>Template placeholders: {fieldname} syntax</li>
                        <li>External URLs preserved (not embedded)</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4>📊 CSV FILES</h4>
                    <ul>
                        <li>UTF-8 encoding with BOM support</li>
                        <li>Headers required in first row</li>
                        <li>Email field: semicolon-separated for multiple addresses</li>
                        <li>Proper CSV escaping for special characters</li>
                        <li>Non-empty content validation enforced</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="section" id="features">
            <h2><span class="emoji">✨</span>Advanced Features</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h4><span class="emoji">📎</span>Attachment System</h4>
                    <ul>
                        <li>Any file type supported</li>
                        <li>Total size limit: 15MB per campaign (configurable)</li>
                        <li>Automatic MIME type detection</li>
                        <li>Safe filename sanitization</li>
                        <li>Pre-send size validation with detailed reporting</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">🖼️</span>Image Embedding</h4>
                    <ul>
                        <li>Automatic HTML img tag processing</li>
                        <li>Inline image embedding (cid: references)</li>
                        <li>Supported formats: JPEG, PNG, GIF, WebP</li>
                        <li>External URL preservation with warnings</li>
                        <li>Base64 encoding for email compatibility</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">⚡</span>Batch Processing</h4>
                    <ul>
                        <li>Default batch size: 500 recipients</li>
                        <li>Configurable delay: 5.0 seconds between batches</li>
                        <li>Automatic retry on temporary failures</li>
                        <li>Progress logging per batch</li>
                        <li>Separate batching for single and multi modes</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">🧪</span>Dry-Run Testing</h4>
                    <ul>
                        <li>Sends DRAFT emails to approvers only</li>
                        <li>Subject automatically prefixed with "DRAFT -"</li>
                        <li>Shows original recipient counts in email</li>
                        <li>Generates comprehensive recipient backup files</li>
                        <li>All attachments and formatting preserved</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">📊</span>Logging System</h4>
                    <ul>
                        <li>CSV-based structured logging</li>
                        <li>Location: /notifybot/logs/notifybot.log</li>
                        <li>Emoji-coded message levels for quick scanning</li>
                        <li>Detailed operation tracking and audit trails</li>
                        <li>Real-time Splunk forwarding for monitoring</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">🔒</span>Security Features</h4>
                    <ul>
                        <li>RFC-compliant sender address validation</li>
                        <li>Enforced base folder restrictions</li>
                        <li>Path traversal attack prevention</li>
                        <li>Safe filename sanitization for attachments</li>
                        <li>Comprehensive audit logging for compliance</li>
                    </ul>
                </div>
            </div>
            
            <h3>Global Signature Management</h3>
            <div class="highlight">
                <ul>
                    <li>Global signature file: /notifybot/signature.html</li>
                    <li>Automatically appended to all email bodies</li>
                    <li>HTML format with full styling support</li>
                    <li>Optional - system works without signature</li>
                    <li>Combined seamlessly with email body content</li>
                </ul>
            </div>
        </div>

        <div class="section" id="logging">
            <h2><span class="emoji">📊</span>Logging & Monitoring</h2>
            
            <p>Comprehensive logging system with structured CSV format and real-time monitoring integration.</p>
            
            <h3>Log Format & Location</h3>
            <div class="code-block">Location: /notifybot/logs/notifybot.log
Format:   timestamp_ms, username, emoji_message

Example:  2025-08-12T10:30:45.123Z, user123, ℹ️ Campaign started: newsletter_august</div>
            
            <h3>Emoji Log Indicators</h3>
            <table>
                <thead>
                    <tr>
                        <th>Emoji</th>
                        <th>Level</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>ℹ️</td><td>Info</td><td>General information and status updates</td></tr>
                    <tr><td>⚠️</td><td>Warning</td><td>Non-critical issues and important notices</td></tr>
                    <tr><td>❌</td><td>Error</td><td>Critical errors and failures</td></tr>
                    <tr><td>✅</td><td>Success</td><td>Successful operations and completions</td></tr>
                    <tr><td>📝</td><td>Draft</td><td>Dry-run and draft operations</td></tr>
                    <tr><td>🔧</td><td>Mode</td><td>Mode and configuration information</td></tr>
                    <tr><td>⏳</td><td>Processing</td><td>Long-running operations</td></tr>
                    <tr><td>💾</td><td>Backup</td><td>File backup and audit operations</td></tr>
                </tbody>
            </table>
            
            <div class="success">
                <h4>📡 Real-time Splunk Integration</h4>
                <p>All logs are forwarded in real-time to <strong>Splunk</strong> for comprehensive auditing, alerting, and long-term analysis.</p>
            </div>
            
            <a class="button-link" href="https://tinyurl/notifybot" target="_blank">
                📊 Open Splunk Dashboard
            </a>
        </div>

        <div class="section" id="usage">
            <h2><span class="emoji">🚀</span>Usage Examples</h2>
            
            <div class="command-examples">
                <h4><span class="emoji">💻</span>Basic Command Structure</h4>
                <div class="code-block"># Basic syntax
/notifybot/venv/bin/python notifybot.py --base-folder &lt;campaign-folder&gt; [OPTIONS]

# Always start with dry-run for safety
/notifybot/venv/bin/python notifybot.py --base-folder newsletter --dry-run

# Test mode with dry-run (safest approach)
/notifybot/venv/bin/python notifybot.py --base-folder newsletter --test --dry-run</div>
            </div>
            
            <h3>Command Line Interface</h3>
            
            <div class="important">
                <strong>Required Arguments:</strong><br>
                <code>--base-folder FOLDER</code> - Campaign folder name in /notifybot/basefolder/
            </div>
            
            <div class="info">
                <h4>Optional Arguments:</h4>
                <ul>
                    <li><code>--mode {single,multi}</code> - Override mode.txt setting</li>
                    <li><code>--dry-run</code> - Send drafts to approvers only (SAFE MODE)</li>
                    <li><code>--test</code> - Use test-inventory.csv instead of inventory.csv</li>
                    <li><code>--test-inventory PATH</code> - Custom test inventory file path</li>
                    <li><code>--force</code> - Skip confirmation prompts (USE WITH CAUTION)</li>
                    <li><code>--batch-size N</code> - Recipients per batch (default: 500)</li>
                    <li><code>--delay SECONDS</code> - Delay between batches (default: 5.0)</li>
                </ul>
            </div>
            
            <div class="command-examples">
                <h4><span class="emoji">📋</span>Common Usage Patterns</h4>
                <div class="code-block"><span class="comment"># 1. Safe testing workflow</span>
notifybot.py --base-folder campaign --test --dry-run    # Test with test data
notifybot.py --base-folder campaign --dry-run           # Test with production data
notifybot.py --base-folder campaign                     # Live run

<span class="comment"># 2. Multi-mode with custom settings</span>
notifybot.py --base-folder personalized --mode multi --batch-size 100 --delay 10

<span class="comment"># 3. Custom test inventory</span>
notifybot.py --base-folder campaign --test-inventory /path/to/test.csv --dry-run

<span class="comment"># 4. Automated deployment (use with extreme caution)</span>
notifybot.py --base-folder automated --test --force

<span class="comment"># 5. Single mode with custom batching</span>
notifybot.py --base-folder newsletter --mode single --batch-size 1000 --delay 2.0</div>
            </div>
            
            <h3>Mode Determination Priority</h3>
            <div class="info">
                <ol>
                    <li>CLI <code>--mode</code> argument (highest priority)</li>
                    <li>mode.txt file in campaign folder</li>
                    <li>Default to 'single' mode</li>
                </ol>
            </div>
        </div>

        <div class="section" id="security">
            <h2><span class="emoji">🔒</span>Security & Best Practices</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h4><span class="emoji">🛡️</span>Email Security</h4>
                    <ul>
                        <li>RFC-compliant email address validation</li>
                        <li>Sendmail injection prevention</li>
                        <li>Proper MIME header encoding</li>
                        <li>Safe filename sanitization for attachments</li>
                        <li>Timeout protection (60 seconds)</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">🗂️</span>File System Security</h4>
                    <ul>
                        <li>Enforced base folder restrictions</li>
                        <li>Path traversal attack prevention</li>
                        <li>UTF-8 encoding enforcement</li>
                        <li>File size limit enforcement (15MB)</li>
                        <li>Safe handling of special characters</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h4><span class="emoji">🔐</span>Data Protection</h4>
                    <ul>
                        <li>No external network access required</li>
                        <li>Local file system operations only</li>
                        <li>Comprehensive audit logging</li>
                        <li>Recipient data protection in logs</li>
                        <li>Safe CSV escaping for special characters</li>
                    </ul>
                </div>
            </div>
            
            <h3>Best Practices</h3>
            <div class="warning">
                <h4>🚨 Critical Safety Rules</h4>
                <ul>
                    <li><strong>Always</strong> run <code>--dry-run</code> before live campaigns</li>
                    <li><strong>Use</strong> <code>--test</code> mode for development and testing</li>
                    <li><strong>Never</strong> use <code>--force</code> in interactive sessions</li>
                    <li><strong>Verify</strong> recipient counts in dry-run emails</li>
                    <li><strong>Review</strong> filter conditions carefully</li>
                    <li><strong>Test</strong> template substitution with small samples</li>
                </ul>
            </div>
            
            <div class="success">
                <h4>✅ Recommended Workflow</h4>
                <ol>
                    <li>Develop campaign with test inventory (<code>--test --dry-run</code>)</li>
                    <li>Test with production inventory (<code>--dry-run</code>)</li>
                    <li>Review dry-run email and recipient counts</li>
                    <li>Execute live campaign (<code>without --dry-run</code>)</li>
                    <li>Monitor logs and Splunk dashboard</li>
                </ol>
            </div>
        </div>

        <div class="footer">
            <h3><span class="emoji">🚀</span>NotifyBot Documentation</h3>
            <p>Version 3.3.0 | Updated August 2025</p>
            <p><em>Advanced Email Campaign Management System</em></p>
        </div>
    </div>
</body>
</html>
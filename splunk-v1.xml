<form>
  <label>NotifyBot - Advanced Email Notification Tool</label>
  <description>NotifyBot User Runbook and Documentation</description>
  
  <!-- Header Section -->
  <row>
    <panel>
      <html>
        <div style="background: linear-gradient(45deg, #2c3e50, #3498db); color: white; padding: 30px; border-radius: 15px; margin-bottom: 20px; text-align: center; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);">
          <h1 style="font-size: 2.5rem; margin-bottom: 10px; text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);">ğŸš€ NotifyBot User Runbook</h1>
          <p style="font-size: 1.2rem; opacity: 0.9; margin-left: 75px;">NotifyBot - Advanced Email Notification Tool</p>
        </div>
      </html>
    </panel>
  </row>

  <!-- Overview Section -->
  <row>
    <panel>
      <title>ğŸ¯ Overview &amp; Key Features</title>
      <html>
        <div style="background: white; padding: 20px; border-radius: 10px; border-left: 5px solid #3498db;">
          <p style="margin-bottom: 15px;"><strong>NotifyBot</strong> is our intelligent, scalable solution for email automation. Whether you're sending a handful of emails or thousands, NotifyBot makes it effortless, safe, and efficient.</p>
          
          <div style="background: linear-gradient(135deg, #87ceeb, #b0e0e6); padding: 20px; border-radius: 10px; margin: 15px 0;">
            <h3 style="color: #2c3e50; margin-top: 0;">ğŸŒŸ Core Capabilities</h3>
            <ul style="margin: 10px 0; padding-left: 20px;">
              <li>ğŸ“§ <strong>Batch Email Sending</strong>: Deliver emails in customizable batches</li>
              <li>ğŸ–‹ï¸ <strong>HTML Email Support</strong>: Rich, styled messages with attachments</li>
              <li>ğŸ¯ <strong>Recipient Filtering</strong>: Advanced CSV filtering with regex support</li>
              <li>ğŸ§ª <strong>Test Mode</strong>: Use separate test inventory for safe testing</li>
              <li>ğŸ“Š <strong>Comprehensive Logging</strong>: Detailed audit trails with Splunk integration</li>
            </ul>
          </div>
          
          <div style="background: #ffe6e6; padding: 15px; border-left: 6px solid #cc0000; margin: 20px 0; border-radius: 6px;">
            <strong>ğŸš¨ Critical Safety Guidelines</strong><br/><br/>
            ğŸ§ª Always run NotifyBot in <code>--dry-run</code> mode first<br/>
            ğŸ§ª Use <code>--test</code> mode for safe testing<br/>
            âŒ Never use <code>--force</code> without approval<br/>
            ğŸ“‚ The campaign directory is inside <code>/notifybot/basefolder/</code>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Operating Modes -->
  <row>
    <panel>
      <title>âš™ï¸ Operating Modes</title>
      <html>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border-top: 4px solid #3498db;">
            <h4 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“¤ SINGLE MODE</h4>
            <ul style="margin: 0; padding-left: 20px;">
              <li>Sends ONE email to all matching recipients</li>
              <li>Template personalization using field substitution</li>
              <li>Batch processing for large recipient lists</li>
              <li><strong>Example:</strong> Company-wide announcement</li>
            </ul>
          </div>
          
          <div style="background: white; padding: 20px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); border-top: 4px solid #3498db;">
            <h4 style="color: #2c3e50; margin-bottom: 10px;">ğŸ“¬ MULTI MODE</h4>
            <ul style="margin: 0; padding-left: 20px;">
              <li>Sends MULTIPLE personalized emails</li>
              <li>Each filter condition generates separate email</li>
              <li>Dynamic table generation support</li>
              <li><strong>Example:</strong> Department-specific notifications</li>
            </ul>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Test Mode Section -->
  <row>
    <panel>
      <title>ğŸ§ª Test Mode (NEW)</title>
      <html>
        <div style="background: #d4edda; border: 3px solid #28a745; padding: 20px; border-radius: 10px; margin: 15px 0;">
          <h3 style="color: #2c3e50; margin-top: 0;">ğŸ¯ Safe Testing Environment</h3>
          <p>Test Mode provides a completely safe testing environment using separate inventory data, ensuring production data remains untouched.</p>
          
          <h4 style="color: #2c3e50; margin: 15px 0 10px 0;">Test Mode Features:</h4>
          <ul style="margin: 0; padding-left: 20px;">
            <li><strong>--test flag:</strong> Uses test-inventory.csv instead of production</li>
            <li><strong>--test-inventory PATH:</strong> Specify custom test file</li>
            <li>Complete isolation from production data</li>
            <li>Compatible with both dry-run and live modes</li>
          </ul>
        </div>
        
        <div style="background: #1a1a1a; color: #f8f8f2; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: monospace;">
          <h4 style="color: #f8f8f2; margin-bottom: 15px;">ğŸ’» Test Mode Commands</h4>
          <div style="margin: 10px 0; background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 5px;">
            <span style="color: #75715e;"># Test mode with dry-run (safest approach)</span><br/>
            /notifybot/venv/bin/python notifybot.py --base-folder campaign --test --dry-run<br/><br/>
            
            <span style="color: #75715e;"># Test mode with custom inventory</span><br/>
            /notifybot/venv/bin/python notifybot.py --base-folder campaign --test-inventory /path/to/test.csv --dry-run<br/><br/>
            
            <span style="color: #75715e;"># Live test mode</span><br/>
            /notifybot/venv/bin/python notifybot.py --base-folder campaign --test
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Directory Structure -->
  <row>
    <panel>
      <title>ğŸ“ Directory Structure</title>
      <html>
        <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; font-family: monospace; border: 1px solid #dee2e6; margin: 15px 0; white-space: pre; overflow-x: auto; line-height: 1.4;">
/notifybot/                          <span style="color: #7f8c8d;"># Root directory</span>
â”œâ”€â”€ basefolder/                      <span style="color: #7f8c8d;"># Base folder for campaigns</span>
â”‚   â””â”€â”€ &lt;campaign-name&gt;/             <span style="color: #7f8c8d;"># Individual campaign folder</span>
â”‚       â”œâ”€â”€ subject.txt              <span style="color: #7f8c8d;"># Email subject line</span>
â”‚       â”œâ”€â”€ body.html                <span style="color: #7f8c8d;"># Email body (HTML)</span>
â”‚       â”œâ”€â”€ from.txt                 <span style="color: #7f8c8d;"># Sender email address</span>
â”‚       â”œâ”€â”€ approver.txt             <span style="color: #7f8c8d;"># Approver emails</span>
â”‚       â”œâ”€â”€ filter.txt               <span style="color: #7f8c8d;"># Filter conditions</span>
â”‚       â”œâ”€â”€ field.txt                <span style="color: #7f8c8d;"># Field names for templates</span>
â”‚       â”œâ”€â”€ mode.txt                 <span style="color: #7f8c8d;"># Mode: 'single' or 'multi'</span>
â”‚       â”œâ”€â”€ attachment/              <span style="color: #7f8c8d;"># File attachments folder</span>
â”‚       â””â”€â”€ images/                  <span style="color: #7f8c8d;"># Email images folder</span>
â”œâ”€â”€ inventory/
â”‚   â”œâ”€â”€ inventory.csv                <span style="color: #7f8c8d;"># Global recipient database</span>
â”‚   â””â”€â”€ test-inventory.csv           <span style="color: #7f8c8d;"># Test recipient database</span>
â”œâ”€â”€ signature.html                   <span style="color: #7f8c8d;"># Global email signature</span>
â””â”€â”€ logs/
    â””â”€â”€ notifybot.log                <span style="color: #7f8c8d;"># Execution logs</span>
        </div>
      </html>
    </panel>
  </row>

  <!-- Filter Syntax -->
  <row>
    <panel>
      <title>ğŸ” Advanced Filter Syntax</title>
      <html>
        <div style="background: white; padding: 20px; border-radius: 10px;">
          <p>Supports advanced PromQL-style filtering with multiple operators and boolean logic:</p>
          
          <table style="width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 8px; overflow: hidden;">
            <thead>
              <tr style="background: #3498db; color: white;">
                <th style="padding: 12px 15px; text-align: left;">Operator</th>
                <th style="padding: 12px 15px; text-align: left;">Description</th>
                <th style="padding: 12px 15px; text-align: left;">Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>=</code></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;">Exact match (case-insensitive)</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>department="Engineering"</code></td>
              </tr>
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>!=</code></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;">Not equal</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>status!="inactive"</code></td>
              </tr>
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>=~</code></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;">Regex match</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>name=~"^John.*"</code></td>
              </tr>
              <tr>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>!~</code></td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;">Regex not match</td>
                <td style="padding: 12px 15px; border-bottom: 1px solid #ddd;"><code>email!~".*(test|demo).*"</code></td>
              </tr>
            </tbody>
          </table>
          
          <div style="background: #1a1a1a; color: #f8f8f2; padding: 15px; border-radius: 8px; font-family: monospace; margin: 15px 0;">
            <span style="color: #75715e;"># AND logic: Same line, comma-separated</span><br/>
            department="Engineering",status="active",region!="asia"<br/><br/>
            
            <span style="color: #75715e;"># OR logic: Different lines</span><br/>
            department="Engineering"<br/>
            department="Sales"<br/>
            department="Marketing"
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Usage Examples -->
  <row>
    <panel>
      <title>ğŸš€ Usage Examples</title>
      <html>
        <div style="background: white; padding: 20px; border-radius: 10px;">
          <div style="background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 5px solid #17a2b8;">
            <h4 style="color: #0c5460; margin-top: 0;">Required Arguments:</h4>
            <p><code>--base-folder FOLDER</code> - Campaign folder name in /notifybot/basefolder/</p>
          </div>
          
          <div style="background: #1a1a1a; color: #f8f8f2; padding: 20px; border-radius: 8px; margin: 15px 0; font-family: monospace;">
            <h4 style="color: #f8f8f2; margin-bottom: 15px;">ğŸ“‹ Common Usage Patterns</h4>
            <div style="background: rgba(255, 255, 255, 0.05); padding: 10px; border-radius: 5px;">
              <span style="color: #75715e;"># 1. Safe testing workflow</span><br/>
              notifybot.py --base-folder campaign --test --dry-run<br/>
              notifybot.py --base-folder campaign --dry-run<br/>
              notifybot.py --base-folder campaign<br/><br/>
              
              <span style="color: #75715e;"># 2. Multi-mode with custom settings</span><br/>
              notifybot.py --base-folder personalized --mode multi --batch-size 100<br/><br/>
              
              <span style="color: #75715e;"># 3. Single mode with batching</span><br/>
              notifybot.py --base-folder newsletter --mode single --batch-size 1000
            </div>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Security & Best Practices -->
  <row>
    <panel>
      <title>ğŸ”’ Security &amp; Best Practices</title>
      <html>
        <div style="background: white; padding: 20px; border-radius: 10px;">
          <div style="background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 5px solid #f39c12;">
            <h4 style="color: #856404; margin-top: 0;">ğŸš¨ Critical Safety Rules</h4>
            <ul style="margin: 0; padding-left: 20px;">
              <li><strong>Always</strong> run <code>--dry-run</code> before live campaigns</li>
              <li><strong>Use</strong> <code>--test</code> mode for development and testing</li>
              <li><strong>Never</strong> use <code>--force</code> in interactive sessions</li>
              <li><strong>Verify</strong> recipient counts in dry-run emails</li>
              <li><strong>Review</strong> filter conditions carefully</li>
            </ul>
          </div>
          
          <div style="background: #d4edda; border: 1px solid #c3e6cb; color: #155724; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 5px solid #28a745;">
            <h4 style="color: #155724; margin-top: 0;">âœ… Recommended Workflow</h4>
            <ol style="margin: 0; padding-left: 20px;">
              <li>Develop campaign with test inventory (<code>--test --dry-run</code>)</li>
              <li>Test with production inventory (<code>--dry-run</code>)</li>
              <li>Review dry-run email and recipient counts</li>
              <li>Execute live campaign (<code>without --dry-run</code>)</li>
              <li>Monitor logs and Splunk dashboard</li>
            </ol>
          </div>
        </div>
      </html>
    </panel>
  </row>

  <!-- Footer -->
  <row>
    <panel>
      <html>
        <div style="background: linear-gradient(45deg, #2c3e50, #3498db); color: white; text-align: center; padding: 30px; border-radius: 10px; margin-top: 20px;">
          <h3>ğŸš€ NotifyBot Documentation</h3>
          <p>Version 3.3.0 | Updated August 2025</p>
          <p><em>Advanced Email Campaign Management System</em></p>
        </div>
      </html>
    </panel>
  </row>
</form>
